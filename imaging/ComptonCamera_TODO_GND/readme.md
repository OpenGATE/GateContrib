
## Description
This example shows the simulation of a Compton Camera.
 
## Set-up
The  camera consists  of two  scintillator crystals (CC_2planes.mac). The structure of the camera is not included in this example. Only sensitive volumes are included.
  
## CCMod actor:
A detailed description of the CCMod actor can be found in  https://doi.org/10.1088/1361-6560/ab6529.
Digitization is further explained in the supplementary material associated with the article.

Digitization chain is applied to the detector layers (absorberSD, scattererSD)
Three different examples are included namely adder, ideal processing and clustering.

*actor_ComptonCamera_2layers_adder.mac
*actor_ComptonCamera_2layers_idealProcessing.mac
*actor_ComptonCamera_2layers_clustering.mac


with the corresponding three main files for each digitization 

*main_2layerCC_adder.mac
*main_2layerCC_ideal.mac
*main_2layerCC_clustering.mac

  
More information about the  digitization modules can be found in https://opengate.readthedocs.io/en/latest/compton_camera_imaging_simulations.html.

## Output

By default two .root output files are created one for singles and another one for  sequence coincidences.
There are three folders namely ideal, adder and clustering with reference output data. These files were generated using v9.0 (tag),  6781 value for the seed and a simulation time of 100 s.


## Tools: Analysis (python script)
plot_seqCoinc.py  script reads sequenceCoincidence root tree and creates some plots.
path variable points to the folder where the .root file is located.
When reading ideal data, generated by main_2layerCC_ideal.mac, the flag IsIdealdata must be set to True. Otherwise IsIdealdata should be False.



## Tools: Executables (from .root to  ASCII list mode file or sivan .tra file) 

Two executables  can be created
*GateRootSeqCoincTree2SivanTraFileConverter 
*GateRootSeqCoincTree2MACACOListMode

The first one takes as input a sequence coincidence root tree file  and creates  the corresponding Sivan .tra file  (format from MEGAlib). 
  ./GateRootSeqCoincTree2SivanTraFileConverter <SequenceCoincidenceInput.root>
Sivan file  contains ideal information. Therefore, in order to get the correct information,   the applied digitization to get the sequence coincidence tree must be ideal. To this end,   the ideal  adder module must be applied to get  the inforamtion of the energy of the photon before and after the  Compton interaction (through energyEini energyFin branches) 
/gate/digitizer/layers/insert adderComptPhotIdeal.
And the singles within the coincidence should be ordered by detection time.

The second one takes as input also a sequence coincidence root tree and generates and ascci file with the information of the coincidences in list mode format. It is made for those systems in which we have one signal per layer  and the singles within a coincidence are ordered by  the  distance to the source. It can be employed for systems composed of 2 or three layers.
For a two layer system  the first single would correspond  to the first layer and the second one to the second layer. The user is responsible for setting the simulation so that these conditions are met.
The format of the file is the following for two layer system
number of layers (2)  1    x_1  y_1   z_1  E_1   2  x_2  y_2  z_2  E_2   3  0  0  0  0
For three layer system:
number of layers (3)  1  x_1  y_1  z_1  E_1 2 x_2 y_2  z_2  E_2  3  x_3  y_3  z_3  E_3 


An example of the instructions to compile the tools
mkdir tools-build
mkdir tools-installed 
cd tools-build
ccmake ../tools
You must insert the path to the Gate source code  and the installation path 
make 
make install






